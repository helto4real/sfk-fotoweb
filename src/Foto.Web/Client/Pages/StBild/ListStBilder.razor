@page "/st-bild/list"
@using Todo.Web.Shared
@using Foto.Web.Client.ApiClients
@inherits AuthorizedBasePage
@inject StBilderApiClient Client;

<div class="container d-flex flex-column justify-content-center align-items-center">
    <div class="row row-cols-auto align-items-center">
         @if (AuthManager.IsAdmin)
         {
            <h2>Dina ST-bilder</h2>
         }
         else
         {
            <h2>ST-bilder</h2>
         }
    </div>
</div>
<div class="container">
    <div class="row g-3 mb-5 justify-content-center align-items-center">
        
        @if (_stBilder.Any())
        {
            <div class="col col-8" style="max-width: 300px;">
                @if (AuthManager.IsAdmin)
                {
                    <div class="form-group">
                        <label>Visa bara mina egna bilder:</label>
                        <input type="checkbox" class="form-check-input mb-2" @onchange="OnUseMyImagesChanged" />
                    </div>
                }
                <table class="table table-striped table-bordered table-hover">
                    <thead>
                    <tr>
                        <th scope="col">Bild</th>
                        <th scope="col"></th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var stBild in _stBilder)
                    {
                        <tr >
                            <td><img class="img-thumbnail mt-2" src="/api/images/image/@stBild.ImageReference?thumb" style="max-width: 8.2em; max-height: 8.2em; object-fit:scale-down;" alt="@stBild.Title" data-bs-toggle="modal" data-bs-target="#@stBild.ImageReference"></td>
                            <td><NavLink class="nav-link" href="@GetEditLink(stBild.Id)"><span>Redigera</span></NavLink></td>
                        </tr>

                    }
                    </tbody>
                </table>
            </div>
            @foreach (var stBild in _stBilder)
            {
                <div class="modal fade" id="@stBild.ImageReference" tabindex="-1" aria-labelledby="@(stBild.Title)" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-fullscreen" data-bs-toggle="modal" data-bs-target="#@stBild.ImageReference">
                        <div class="modal-content">
                            <div class="modal-body d-flex p-3">
                                <img src="/api/images/image/@stBild.ImageReference" class="img-fluid m-auto" alt="@stBild.Title" style="max-width: 100%; max-height: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
    </div>
</div>

@code {
    private List<StBildInfo> _stBilder = new();
    private bool UseMyImages { get; set; } = false;
    
    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        await PopulateStBilderList();
    }

    private async Task PopulateStBilderList()
    {
        _stBilder = await Client.GetStBilder(UseMyImages);
        StateHasChanged();
    }

    private Task OnUseMyImagesChanged(ChangeEventArgs e)
    {
        UseMyImages = Convert.ToBoolean(e.Value);
        return PopulateStBilderList();
    }
    private string GetEditLink(Guid imageId) => $"/st-bild/edit/{imageId}";

}