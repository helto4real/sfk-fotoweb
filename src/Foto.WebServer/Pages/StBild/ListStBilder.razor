@page "/st-bild/list"
@using Foto.WebServer.Dto
@using Foto.WebServer.Services
@inherits AuthorizedBasePage
@inject IStBildService StBildService

<PageTitle>Visa ST-bilder</PageTitle>

<AppContent ContentMaxWidth="MaxWidth.Medium">
    <Title>Visa ST-bilder</Title>
    <Ingress>Här visas dina uppladdade ST-bilder.</Ingress>
    <Container>
        @if (_stBilder.Any())
        {
            <MudGrid Class="mt-4" Spacing="3" Justify="Justify.Center">
                @foreach (var stBild in _stBilder)
                {
                    <MudItem Class="d-flex align-center justify-center mud-width-full" xl="3" md="4" sm="6" xs="12">
                        <StImageCard StBild = "@stBild"/>
                    </MudItem>
                }
            </MudGrid>
        }
        else
        {
            <MudAlert Severity="Severity.Warning" Variant="Variant.Text">
                <p >
                    Inga ST bilder uppladdade att visa. Ladda upp en bild genom att klicka på "Ladda upp ST-bild" i menyn.
                </p>
            </MudAlert>
        }

    </Container>
</AppContent>


@* <div class="container d-flex flex-column justify-content-center align-items-center"> *@
@*     <div class="row row-cols-auto align-items-center"> *@
@*         <h2>Dina ST-bilder</h2> *@
@*     </div> *@
@* </div> *@
@* @if (_stBilder is not null) *@
@* { *@
@*     <div class="container mt-3"> *@
@*         <div class="row g-3 mb-5 justify-content-center align-items-center"> *@
@*                 <div class="col col-8" style="max-width: 300px;"> *@
@*                     <div class="form-group"> *@
@*                         <label style="margin-right: 7px">Visa skickade bilder ST:</label> *@
@*                         @if (ShowPackagedImages) *@
@*                         { *@
@*                             <input type="checkbox" class="form-check-input mb-2" checked @onchange="OnShowPackagedImagesChanged"/> *@
@*                         } *@
@*                         else *@
@*                         { *@
@*                             <input type="checkbox" class="form-check-input mb-2" unchecked @onchange="OnShowPackagedImagesChanged"/> *@
@*                         } *@
@*                     </div> *@
@*                     @if (_stBilder.Any()) *@
@*                     { *@
@*                         <table class="table table-striped table-bordered table-hover mt-2"> *@
@*                             <thead> *@
@*                             <tr> *@
@*                                 <th class="col m-2 text-center">Bild</th> *@
@*                                 @if (ShowPackagedImages) *@
@*                                 { *@
@*                                     <th class="col m-2 text-center">Status</th> *@
@*                                 } *@
@*                                 <th class="col m-2 text-center">Åtgärd</th> *@
@*                             </tr> *@
@*                             </thead> *@
@*                             <tbody> *@
@*                             @foreach (var stBild in _stBilder) *@
@*                             { *@
@*                                 <tr > *@
@*                                     <td class="text-center"><img class="img-thumbnail m-1" src="/api/images/image/@stBild.ImageReference?thumb" style="max-width: 8.2em; max-height: 8.2em; object-fit:scale-down;" alt="@stBild.Title" data-bs-toggle="modal" data-bs-target="#@stBild.ImageReference"></td> *@
@*                                     @if (ShowPackagedImages) *@
@*                                     { *@
@*                                     <td class="text-center m-1">@GetImageStatus(stBild)</td> *@
@*                                     } *@
@*                                     <td><NavLink class="nav-link text-center" href="@GetEditLink(stBild.Id)"><span>Redigera</span></NavLink></td> *@
@*                                 </tr> *@
@*                             } *@
@*                             </tbody> *@
@*                         </table> *@
@*                     } *@
@*                     else *@
@*                     { *@
@*                         <div class="container d-flex flex-column justify-content-center align-items-center"> *@
@*                             @if (ShowPackagedImages) *@
@*                             { *@
@*                                 <div class="row row-cols-auto align-items-center"> *@
@*                                     Du har inga bilder än. Ladda upp en bild genom att klicka på "Ladda upp ST-bild" i menyn. *@
@*                                 </div> *@
@*                             } *@
@*                             else *@
@*                             { *@
@*                                 <div class="row row-cols-auto align-items-center"> *@
@*                                     Du har inga bilder som inte är godkända och skickade. Ladda upp en bild genom att klicka på "Ladda upp ST-bild" i menyn. *@
@*                                 </div> *@
@*                             } *@
@*                         </div> *@
@*                     } *@
@*                 </div> *@
@*                 @foreach (var stBild in _stBilder) *@
@*                 { *@
@*                     <div class="modal fade" id="@stBild.ImageReference" tabindex="-1" aria-labelledby="@(stBild.Title)" aria-hidden="true"> *@
@*                         <div class="modal-dialog modal-dialog-centered modal-fullscreen" data-bs-toggle="modal" data-bs-target="#@stBild.ImageReference"> *@
@*                             <div class="modal-content"> *@
@*                                 <div class="modal-body d-flex p-5"> *@
@*                                     <img src="/api/images/image/@stBild.ImageReference" class="img-fluid m-auto mw-100 mh-100" alt="@stBild.Title" style="max-width: 100%; max-height: 100%;"> *@
@*                                 </div> *@
@*                             </div> *@
@*                         </div> *@
@*                     </div> *@
@*                 } *@
@*         </div> *@
@*     </div> *@
@* } *@
@* else *@
@* { *@
@*     <div class="container d-flex flex-column justify-content-center align-items-center"> *@
@*         <div class="row row-cols-auto align-items-center"> *@
@*             Sidan laddas... *@
@*         </div> *@
@*     </div> *@
@* } *@

@code {
    private List<StBildInfo> _stBilder = new();
    private bool ShowPackagedImages { get; set; } = true;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await PopulateStBilderList();
        }
        await base.OnAfterRenderAsync(firstRender);
    }

    private async Task PopulateStBilderList()
    {
        _stBilder = await StBildService.GetStBilderForCurrentUser(ShowPackagedImages);
        StateHasChanged();
    }

    private Task OnShowPackagedImagesChanged(ChangeEventArgs e)
    {
        ShowPackagedImages = Convert.ToBoolean(e.Value);
        return PopulateStBilderList();
    }

    private string GetEditLink(Guid imageId) => $"/st-bild/edit/{imageId}";

    private string GetImageStatus(StBildInfo stBild)
    {
        if (stBild.IsUsed) return "Skickad";
        return stBild.IsAccepted ? "Godkänd" : "Hanteras";
    }

}